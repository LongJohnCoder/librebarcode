#!/usr/bin/env node
"use strict";

exports.command = {
    description: 'TODO'
  , arguments: '[targetdir]'
};

if (require.main === module) {

var requirejs = require('requirejs')
  , configure = requirejs('./node-config')
  , path = require('path')
  , program = require('commander')
  ;
configure(requirejs);

program._name = path.basename(process.argv[1]).replace('-', ' ');
program.arguments(exports.command.arguments)
    .description(exports.command.description);

requirejs([
    'Atem-IO/io/staticNodeJS'
  , 'BarcodeLibre/builder'
], function (
    io
  , builder
) {

    function main (targetdir) {
        if(!targetdir)
            throw new Error('Please suppply [targetdir] argument.');
        // Not entirely sure if this is actually needed but it may help
        // to avoid mistakes. In the end, we don't want to update existing
        // ufos but create new ones.
        if(io.pathExists(false, targetdir))
            throw new Error('[targetdir] must not exist: "'+targetdir+'".');
        io.ensureDir(false, targetdir);

        builder(io, targetdir);
        //return

        //var rootDir = path.dirname(path.dirname(require.main.filename))
        //  , baseDir = getBaseDir(projectDirArgument)
        //  ;
    }
    program.action(main);
    //program .option('-p, --port <n>', 'The port to listen on (default: environment variable MOM_DEV_PORT (if unset, random))', parseInt);
    program.parse(process.argv);
});

}
